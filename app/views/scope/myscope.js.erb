    var countryName = document.getElementById('country-name');
    var speakers = document.getElementById('speakers');

    var countryCollection = {};

    <% @scope.each do |key,value| %>

        countryCollection["<%=key%>"] = {
            fillKey: colorFill("<%=value[0]%>"),
            population: "<%=value[1]%>",
            percentage: "<%=value[0]%>"
        }

    <%end%>

    function colorFill(amount) {
        if(amount < 20000000) {
            return "LOW";
        } else if(amount > 20000000 && amount < 100000000) {
            return "MEDIUM";
        } else {
            return "HIGH";
        }
    }

    var map = new Datamap({
        element: document.getElementById('container'),
        fills: {
            HIGH: '#38496C',
            LOW: '#65C7FF',
            MEDIUM: '#3E78D6',
            UNKNOWN: 'rgb(0,0,0)',
            defaultFill: '#B4DDED'
        },
        data: countryCollection,
        geographyConfig: {
            borderColor: '#FFFFFF',
            highlightBorderWidth: 1,
            highlightBorderColor: '#899D82',
            highlightFillColor: '#89E882',
            popupTemplate: function(geo, data) {
                countryName.textContent = geo.properties.name;
                if (data) {
                    speakers.textContent = data.population;                    
                
                } else {
                    speakers.textContent = "Not available";
                }
            }
        }
    });